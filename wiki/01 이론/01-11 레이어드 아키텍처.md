# 레이어드 아키텍처 (Layered Architecture)

## 핵심 개념
- 시스템을 **기능적 책임**에 따라 레이어로 나누고, 각 레이어가 자신보다 하위 레이어에만 의존하도록 설계하는 구조
- 비즈니스 로직, 데이터 접근, 사용자 인터페이스 같은 역할을 명확히 분리하고 독립적으로 관리하기 위한 구조
- "상위 레이어는 하위 레이어에만 의존한다"는 규칙 강조 → 단방향 의존


<br/>


## 3계층 레이어드 아키텍처

### Spring 기본
- Controller - Service - Repository Layer
- [01-11-Layered-Architecture-01.puml](uml/01-11-Layered-Architecture-01.puml)

### 다양한 레이어 이름
- Controller
    - UI, Presentation
- Service
    - Business, Business Logic, Application, Domain
- Repository(DAO)
    - Data Access, Persistence, Infrastructure

### 개인적 권장 이름
- Presentation - Application - Infrastructure

### 레이어 구조
- [01-11-Layered-Architecture-02.puml](uml/01-11-Layered-Architecture-02.puml)

<br/>


## 4계층 레이어 아키텍처

### 등장
- 애플리케이션의 복잡성 증가와 책임 분리 필요성
- 복잡한 유스케이스 증가
    - DDD와 같은 도메인 중심 설계 도입
    - 테스트, 재사용, 유지보수성 향상 목적

### 레이어 분리
- 하나의 Application을 Application, Domain으로 분리
    - 또는, Domain 레이어에서 Application 레이어를 별도로 분리
- Application Layer
    - 비즈니스 로직과 UI 로직을 명확히 분리
    - 서비스 간 통신, 트랜잭션, 보안, 로깅 같은 공통 기능 처리
    - 트랜잭션 스크립트 관리
    - 도메인 서비스 호출 조합
    - 입/출력 변환 (DTO ←→ Domain 객체 변환)
- Domain Layer
    - 핵심 도메인 로직만 집중
    - 엔터티, VO, 도메인 서비스, 애그리거트 중심으로 구성
    - 외부 기술(예:JPA, Kafka 등)에 의존하지 않는 순수 모델
- Infrastructure Layer
    - 데이터베이스 외에도 외부 API, 메시지 브로커, 파일 시스템, SMTP 등도 포함

### 개인적 권장 이름
- Presentation - Application - Domain - Infrastructure

### 레이어 구조
- 기본: [01-11-Layered-Architecture-03.puml](uml/01-11-Layered-Architecture-03.puml)
- 변형: [01-11-Layered-Architecture-04.puml](uml/01-11-Layered-Architecture-04.puml)
- DIP: [01-11-Layered-Architecture-05.puml](uml/01-11-Layered-Architecture-05.puml)

<br/>


## 레이어드 아키텍처의 한계

### 설계(경계) 미흡 시의 허울뿐인 분리
- 도메인 모델을 제대로 설계하지 않으면 Application 레이어에 로직이 다시 집중 (실질적 3계층 레이어)

### 레이어 간 호출 오버헤드와 복잡성
- 요청이 여러 레이어를 거치며 호출 체인이 길어져 구현 복잡도와 디버깅 난이도 상승

### 복잡한 트랜잭션 경계 관리
- Application 레이어에서 트랜잭션을 조율하더라도 분산 트랜잭션, 여러 서비스에 걸친 일관성 유지 어려움

### 인프라 변화에 따른 영향
- Infrastructure가 다양해지면(외부 API, 메시지 브로커 등) 어댑터 코드가 많아짐
- 도메인 ↔ 인프라 연결 지점 관리 번거로움

### 테스트 작성의 복잡성
- 레이어가 늘어나면 모킹/스텁이 많아져 단위테스트 설정이 번거로움
